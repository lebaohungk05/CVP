<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé• Camera Test - Ki·ªÉm tra Camera</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .test-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            padding: 40px;
            margin: 50px auto;
            max-width: 800px;
        }

        .video-container {
            position: relative;
            text-align: center;
            margin: 30px 0;
        }

        #testVideo {
            max-width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .btn-custom {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 500;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            color: white;
        }

        .status-indicator {
            padding: 10px 20px;
            border-radius: 15px;
            margin: 15px 0;
            font-weight: 600;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d9ff;
        }

        .device-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-container">
            <div class="text-center mb-4">
                <h1><i class="fas fa-video"></i> Camera Test Tool</h1>
                <p class="lead">Ki·ªÉm tra camera c·ªßa b·∫°n c√≥ ho·∫°t ƒë·ªông kh√¥ng</p>
            </div>

            <div id="status" class="status-indicator status-info">
                <i class="fas fa-info-circle"></i> Nh·∫•n "Test Camera" ƒë·ªÉ b·∫Øt ƒë·∫ßu ki·ªÉm tra
            </div>

            <div class="text-center">
                <button id="testBtn" class="btn btn-custom">
                    <i class="fas fa-play"></i> Test Camera
                </button>
                <button id="stopBtn" class="btn btn-danger" style="display: none;">
                    <i class="fas fa-stop"></i> D·ª´ng Test
                </button>
            </div>

            <div class="video-container">
                <video id="testVideo" style="display: none;" autoplay muted playsinline></video>
                <div id="placeholder" class="text-center py-5">
                    <i class="fas fa-video" style="font-size: 4rem; color: #ccc;"></i>
                    <p class="text-muted mt-3">Video s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y khi camera ƒë∆∞·ª£c k√≠ch ho·∫°t</p>
                </div>
            </div>

            <div class="device-info" id="deviceInfo" style="display: none;">
                <h5><i class="fas fa-info-circle"></i> Th√¥ng tin thi·∫øt b·ªã:</h5>
                <div id="deviceDetails"></div>
            </div>

            <div class="mt-4">
                <h5>üìã Troubleshooting Checklist:</h5>
                <div class="checklist">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="check1">
                        <label class="form-check-label" for="check1">
                            Camera ƒë∆∞·ª£c k·∫øt n·ªëi v√† b·∫≠t
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="check2">
                        <label class="form-check-label" for="check2">
                            ƒê√£ cho ph√©p browser truy c·∫≠p camera
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="check3">
                        <label class="form-check-label" for="check3">
                            Camera kh√¥ng b·ªã app kh√°c s·ª≠ d·ª•ng
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="check4">
                        <label class="form-check-label" for="check4">
                            Windows Camera Privacy ƒë√£ ƒë∆∞·ª£c b·∫≠t
                        </label>
                    </div>
                </div>
            </div>

            <div class="mt-4 text-center">
                <div class="row">
                    <div class="col-md-4">
                        <div class="p-3">
                            <i class="fas fa-cog" style="font-size: 2rem; color: #667eea;"></i>
                            <h6 class="mt-2">Chrome Settings</h6>
                            <button class="btn btn-sm btn-outline-primary" onclick="window.open('chrome://settings/content/camera', '_blank')">
                                M·ªü Settings
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3">
                            <i class="fas fa-shield-alt" style="font-size: 2rem; color: #667eea;"></i>
                            <h6 class="mt-2">Windows Privacy</h6>
                            <button class="btn btn-sm btn-outline-primary" onclick="alert('B·∫•m Win + I ‚Üí Privacy & Security ‚Üí Camera')">
                                H∆∞·ªõng d·∫´n
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3">
                            <i class="fas fa-home" style="font-size: 2rem; color: #667eea;"></i>
                            <h6 class="mt-2">Quay l·∫°i App</h6>
                            <a href="../" class="btn btn-sm btn-outline-primary">
                                Emotion App
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const testBtn = document.getElementById('testBtn');
        const stopBtn = document.getElementById('stopBtn');
        const video = document.getElementById('testVideo');
        const placeholder = document.getElementById('placeholder');
        const status = document.getElementById('status');
        const deviceInfo = document.getElementById('deviceInfo');
        const deviceDetails = document.getElementById('deviceDetails');

        let stream = null;

        function updateStatus(message, type = 'info') {
            status.className = `status-indicator status-${type}`;
            
            let icon = 'fas fa-info-circle';
            if (type === 'success') icon = 'fas fa-check-circle';
            if (type === 'error') icon = 'fas fa-exclamation-triangle';
            
            status.innerHTML = `<i class="${icon}"></i> ${message}`;
        }

        async function showDeviceInfo() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                let html = `<strong>S·ªë camera t√¨m th·∫•y:</strong> ${videoDevices.length}<br>`;
                
                videoDevices.forEach((device, index) => {
                    html += `<strong>Camera ${index + 1}:</strong> ${device.label || 'Unknown Camera'}<br>`;
                });
                
                html += `<br><strong>Browser:</strong> ${navigator.userAgent.split(' ').slice(-1)[0]}<br>`;
                html += `<strong>Platform:</strong> ${navigator.platform}<br>`;
                html += `<strong>HTTPS:</strong> ${location.protocol === 'https:' ? 'Yes' : 'No'}`;
                
                deviceDetails.innerHTML = html;
                deviceInfo.style.display = 'block';
                
            } catch (err) {
                deviceDetails.innerHTML = 'Kh√¥ng th·ªÉ l·∫•y th√¥ng tin thi·∫øt b·ªã';
                deviceInfo.style.display = 'block';
            }
        }

        testBtn.addEventListener('click', async () => {
            try {
                updateStatus('üîÑ ƒêang ki·ªÉm tra camera...', 'info');
                
                // Check support
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('Browser kh√¥ng h·ªó tr·ª£ camera API');
                }
                
                // Get camera access
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 640 }, 
                        height: { ideal: 480 }
                    } 
                });
                
                // Show video
                video.srcObject = stream;
                video.style.display = 'block';
                placeholder.style.display = 'none';
                
                // Update UI
                testBtn.style.display = 'none';
                stopBtn.style.display = 'inline-block';
                
                updateStatus('‚úÖ Camera ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng! B·∫°n c√≥ th·ªÉ th·∫•y video t·ª´ camera.', 'success');
                
                // Show device info
                await showDeviceInfo();
                
            } catch (err) {
                console.error('Camera test error:', err);
                
                let errorMsg = '‚ùå Camera test th·∫•t b·∫°i: ';
                let solution = '';
                
                switch(err.name) {
                    case 'NotAllowedError':
                        errorMsg += 'Quy·ªÅn truy c·∫≠p camera b·ªã t·ª´ ch·ªëi.';
                        solution = ' Click v√†o üîí icon b√™n tr√°i URL v√† cho ph√©p camera.';
                        break;
                    case 'NotFoundError':
                        errorMsg += 'Kh√¥ng t√¨m th·∫•y camera.';
                        solution = ' Ki·ªÉm tra camera c√≥ ƒë∆∞·ª£c k·∫øt n·ªëi kh√¥ng.';
                        break;
                    case 'NotReadableError':
                        errorMsg += 'Camera ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng.';
                        solution = ' ƒê√≥ng c√°c app kh√°c nh∆∞ Skype, Teams, Zoom.';
                        break;
                    default:
                        errorMsg += err.message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh.';
                        solution = ' Th·ª≠ restart browser ho·∫∑c computer.';
                }
                
                updateStatus(errorMsg + solution, 'error');
            }
        });

        stopBtn.addEventListener('click', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            video.style.display = 'none';
            placeholder.style.display = 'block';
            testBtn.style.display = 'inline-block';
            stopBtn.style.display = 'none';
            
            updateStatus('Camera ƒë√£ ƒë∆∞·ª£c d·ª´ng. Nh·∫•n "Test Camera" ƒë·ªÉ ki·ªÉm tra l·∫°i.', 'info');
        });

        // Show browser and system info
        window.addEventListener('load', () => {
            setTimeout(async () => {
                await showDeviceInfo();
            }, 1000);
        });
    </script>
</body>
</html> 